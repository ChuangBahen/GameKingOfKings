# Feature Specification: UI 優化

**Feature Branch**: `001-ui-optimization`
**Created**: 2025-12-17
**Status**: Draft
**Input**: User description: "UI 優化：訊息視窗分離、小地圖即時更新、背包系統優化、角色狀態即時更新、職業技能系統"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 角色狀態即時同步 (Priority: P1)

玩家在遊戲過程中（戰鬥、升級、休息、使用物品等），能夠即時看到自己角色的完整狀態，包括生命值、魔力值、經驗值、等級、五維屬性（力量、敏捷、智力、智慧、體質）以及裝備帶來的加成。

**Why this priority**: 角色狀態是遊戲核心資訊，玩家需要依據這些資訊做出戰鬥決策。如果狀態不即時，會導致玩家做出錯誤判斷。

**Independent Test**: 可透過登入遊戲後查看狀態面板，進行戰鬥或使用物品後驗證數值是否即時更新。

**Acceptance Scenarios**:

1. **Given** 玩家已登入遊戲, **When** 連線成功, **Then** 狀態面板顯示完整角色資訊（名稱、職業、等級、HP、MP、EXP、五維屬性、裝備加成）
2. **Given** 玩家在戰鬥中受到傷害, **When** HP 變化, **Then** HP 數值在 1 秒內更新顯示
3. **Given** 玩家擊敗怪物獲得經驗, **When** 經驗值累積, **Then** 經驗條即時更新，若升級則顯示新等級和屬性提升
4. **Given** 玩家裝備新武器, **When** 裝備成功, **Then** 攻擊力加成即時更新顯示

---

### User Story 2 - 訊息視窗分離 (Priority: P1)

玩家在遊戲中能夠區分戰鬥訊息與一般遊戲訊息，戰鬥時的傷害數值、技能使用等資訊在戰鬥記錄視窗顯示，移動、系統通知、物品獲得等在一般訊息視窗顯示。

**Why this priority**: 戰鬥時關鍵訊息（傷害、治療、戰鬥結果）容易被其他訊息淹沒，影響玩家判斷。

**Independent Test**: 可透過進入戰鬥查看戰鬥視窗是否只顯示戰鬥相關訊息，一般視窗是否排除戰鬥訊息。

**Acceptance Scenarios**:

1. **Given** 玩家進行移動, **When** 收到房間描述訊息, **Then** 訊息顯示在一般訊息視窗
2. **Given** 玩家在戰鬥中, **When** 對怪物造成傷害, **Then** 傷害訊息顯示在戰鬥記錄視窗
3. **Given** 玩家同時有戰鬥和一般訊息, **When** 切換視窗 Tab, **Then** 只顯示該類型的訊息
4. **Given** 戰鬥中有新訊息, **When** 玩家在一般訊息 Tab, **Then** 戰鬥 Tab 顯示未讀數量提示

---

### User Story 3 - 背包系統優化 (Priority: P2)

玩家能夠清楚看到背包中所有物品的詳細資訊，包括物品名稱、類型、數量、屬性加成、效果說明，並能區分已裝備與未裝備物品。

**Why this priority**: 背包是玩家管理裝備和消耗品的核心介面，清晰的資訊展示能提升遊戲體驗。

**Independent Test**: 可透過查看背包面板驗證物品資訊是否完整顯示，獲得新物品後背包是否即時更新。

**Acceptance Scenarios**:

1. **Given** 玩家打開背包, **When** 背包有物品, **Then** 顯示物品條列清單，包含名稱、類型、數量
2. **Given** 玩家查看武器物品, **When** 點選該物品, **Then** 顯示攻擊力加成、裝備需求等詳細資訊
3. **Given** 玩家裝備物品, **When** 裝備成功, **Then** 該物品在背包中標記為「已裝備」
4. **Given** 玩家擊敗怪物獲得掉落物, **When** 物品進入背包, **Then** 背包清單即時更新

---

### User Story 4 - 小地圖即時更新 (Priority: P2)

玩家能夠在小地圖上看到當前所在位置、可移動的方向，以及相鄰房間的基本資訊。

**Why this priority**: 小地圖幫助玩家導航，了解探索進度和可移動方向。

**Independent Test**: 可透過移動指令驗證小地圖是否正確更新當前位置和可用出口。

**Acceptance Scenarios**:

1. **Given** 玩家登入遊戲, **When** 進入房間, **Then** 小地圖顯示當前房間名稱和可用出口方向
2. **Given** 玩家執行移動指令, **When** 移動成功, **Then** 小地圖更新顯示新位置
3. **Given** 房間有多個出口, **When** 查看小地圖, **Then** 顯示所有可用方向（北、南、東、西）
4. **Given** 相鄰房間有怪物, **When** 查看小地圖, **Then** 該方向顯示怪物存在提示

---

### User Story 5 - 職業技能系統 (Priority: P3)

玩家能夠查看自己職業可用的技能列表，了解已學習的技能和尚未解鎖的技能，以及各技能的使用方式和效果。

**Why this priority**: 技能是戰鬥的核心玩法，但在基本狀態和背包功能完善後再實作。

**Independent Test**: 可透過查看技能面板驗證是否顯示正確的職業技能、學習狀態和使用說明。

**Acceptance Scenarios**:

1. **Given** 玩家打開技能面板, **When** 查看技能列表, **Then** 顯示職業對應的所有技能
2. **Given** 玩家等級達到技能需求, **When** 查看技能, **Then** 該技能標記為「已學習」且可使用
3. **Given** 玩家等級不足, **When** 查看高等技能, **Then** 顯示「需要等級 X」解鎖提示
4. **Given** 玩家查看技能詳情, **When** 點選技能, **Then** 顯示技能說明、MP 消耗、冷卻時間、使用指令

---

### Edge Cases

- 當玩家網路斷線時，狀態面板如何顯示？（顯示「已斷線」狀態指示）
- 當背包已滿時，獲得新物品如何處理？（顯示「背包已滿」提示）
- 當訊息量過大時，如何管理？（各視窗保留最近 100 條訊息，自動清除舊訊息）
- 當玩家快速切換房間時，小地圖更新速度如何？（確保每次移動都更新，無累積延遲）

## Requirements *(mandatory)*

### Functional Requirements

**角色狀態系統**
- **FR-001**: 系統必須在玩家登入時推送完整角色狀態（名稱、職業、等級、HP、MP、EXP、五維屬性、裝備加成）
- **FR-002**: 系統必須在角色狀態變化時即時推送更新（HP/MP 變化、經驗獲得、升級、裝備變更）
- **FR-003**: 狀態面板必須顯示五維屬性（STR、DEX、INT、WIS、CON）及其裝備加成值
- **FR-004**: 狀態面板必須顯示裝備帶來的攻擊力和防禦力加成

**訊息視窗系統**
- **FR-005**: 系統必須將訊息分類為「戰鬥訊息」和「一般訊息」兩種類型
- **FR-006**: 戰鬥訊息視窗必須只顯示傷害、治療、技能使用、戰鬥結果等戰鬥相關訊息
- **FR-007**: 一般訊息視窗必須顯示移動、房間描述、系統通知、物品獲得等非戰鬥訊息
- **FR-008**: 系統必須提供訊息視窗切換功能，並在非當前視窗有新訊息時顯示未讀提示

**背包系統**
- **FR-009**: 背包面板必須以條列方式顯示所有物品，包含名稱、圖示、類型、數量
- **FR-010**: 系統必須區分顯示已裝備物品和背包物品
- **FR-011**: 物品詳情必須顯示屬性加成、效果說明、裝備需求
- **FR-012**: 系統必須在背包內容變化時即時更新顯示

**小地圖系統**
- **FR-013**: 小地圖必須顯示當前房間名稱
- **FR-014**: 小地圖必須顯示可用的移動方向（北、南、東、西）
- **FR-015**: 系統必須在玩家移動時即時更新小地圖
- **FR-016**: 小地圖必須顯示相鄰房間的基本資訊（名稱、是否有怪物）

**技能系統**
- **FR-017**: 技能面板必須顯示玩家職業的所有技能
- **FR-018**: 系統必須區分顯示已學習技能和未解鎖技能
- **FR-019**: 技能詳情必須顯示技能名稱、說明、MP 消耗、冷卻時間、學習等級需求
- **FR-020**: 系統必須在玩家升級時更新技能學習狀態

### Key Entities

- **PlayerFullStats**: 角色完整狀態，包含名稱、職業、等級、HP/MP、EXP、五維屬性、裝備加成
- **GameMessage**: 遊戲訊息，包含類型（戰鬥/一般）、內容、時間戳記
- **InventoryItem**: 背包物品，包含名稱、類型、數量、是否裝備、屬性資訊
- **MapData**: 地圖資料，包含當前房間、可用出口、相鄰房間資訊
- **SkillInfo**: 技能資訊，包含技能 ID、名稱、說明、消耗、冷卻、學習需求、學習狀態

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 玩家登入後 2 秒內看到完整的角色狀態資訊
- **SC-002**: 角色狀態變化（HP、MP、EXP）在 1 秒內反映到介面上
- **SC-003**: 玩家能在 3 秒內區分戰鬥訊息和一般訊息
- **SC-004**: 背包物品資訊完整度達 100%（所有物品顯示名稱、類型、數量、屬性）
- **SC-005**: 小地圖在玩家移動後 1 秒內更新顯示
- **SC-006**: 技能面板正確顯示玩家職業的所有可用技能（已學習和未解鎖）
- **SC-007**: 90% 的玩家能在首次使用時理解各面板的資訊

## Assumptions

1. 現有的 SignalR 連線架構足以支援即時資料推送
2. 後端已有角色、物品、技能的完整資料模型
3. 前端使用 Vue 3 + Pinia 進行狀態管理
4. 遊戲為單人遊玩模式，不需考慮多玩家同步
5. 訊息保留數量為各類型最近 100 條
6. 小地圖只顯示當前房間和直接相鄰的房間（一步距離）
